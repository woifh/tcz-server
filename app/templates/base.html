<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Tennisclub Reservierung{% endblock %}</title>
    <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        .material-icons { vertical-align: middle; }
        /* Hide elements until Alpine.js loads */
        [x-cloak] { display: none !important; }
        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        /* Show skip links when focused */
        .focus\:not-sr-only:focus {
            position: static;
            width: auto;
            height: auto;
            padding: 0.5rem 1rem;
            margin: 0;
            overflow: visible;
            clip: auto;
            white-space: normal;
        }
    </style>
</head>
<body class="bg-gray-100" x-data="{ mobileMenuOpen: false }">
    <nav class="bg-green-700 text-white p-4" id="main-navigation">
        <div class="container mx-auto">
            <!-- Desktop/Tablet Navigation -->
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold flex items-center gap-2">
                    <span class="material-icons">sports_tennis</span>
                    <span class="hidden sm:inline">Tennisclub Zellerndorf</span>
                    <span class="sm:hidden">TC Zellerndorf</span>
                </h1>

                <div class="flex items-center gap-4">
                    <!-- Desktop Menu (hidden on mobile) -->
                    <!-- Desktop Menu (hidden on mobile) -->
                    <div class="hidden lg:flex gap-4 items-center">
                    {% if current_user.is_authenticated %}
                        <!-- Dashboard Link -->
                        <a href="{{ url_for('dashboard.dashboard') }}" class="hover:bg-green-600 px-3 py-2 rounded transition-colors flex items-center gap-1">
                            <span class="material-icons text-sm">dashboard</span>
                            <span>Platzübersicht</span>
                        </a>

                        <!-- Admin Panel Dropdown (only for admins) -->
                        {% if current_user.is_admin() %}
                        <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="hover:bg-green-600 px-3 py-2 rounded transition-colors flex items-center gap-1" aria-haspopup="true" :aria-expanded="open">
                                <span class="material-icons text-sm">admin_panel_settings</span>
                                <span>Admin</span>
                                <span class="material-icons text-sm" :class="{ 'rotate-180': open }" style="transition: transform 0.2s">expand_more</span>
                            </button>
                            <div x-show="open" x-cloak x-transition:enter="transition ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95" class="absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-50">
                                <div class="py-1">
                                    <a href="{{ url_for('admin.overview') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <span class="material-icons text-sm">home</span>
                                        <span>Übersicht</span>
                                    </a>
                                    <a href="{{ url_for('admin.court_blocking') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <span class="material-icons text-sm">block</span>
                                        <span>Platz-Sperrungen</span>
                                    </a>
                                    <a href="{{ url_for('admin.reasons') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <span class="material-icons text-sm">list_alt</span>
                                        <span>Sperrungsgründe</span>
                                    </a>
                                    <a href="{{ url_for('admin.calendar') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <span class="material-icons text-sm">calendar_month</span>
                                        <span>Kalenderansicht</span>
                                    </a>
                                    <a href="{{ url_for('members.list_members') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <span class="material-icons text-sm">people</span>
                                        <span>Mitglieder</span>
                                    </a>
                                    <a href="{{ url_for('admin.audit_log') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <span class="material-icons text-sm">history</span>
                                        <span>Audit-Protokoll</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Teamster Panel Dropdown (teamsters only, NOT admins) -->
                        {% if current_user.is_teamster() and not current_user.is_admin() %}
                        <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="hover:bg-green-600 px-3 py-2 rounded transition-colors flex items-center gap-1" aria-haspopup="true" :aria-expanded="open">
                                <span class="material-icons text-sm">block</span>
                                <span>Platz-Sperrungen</span>
                                <span class="material-icons text-sm" :class="{ 'rotate-180': open }" style="transition: transform 0.2s">expand_more</span>
                            </button>
                            <div x-show="open" x-cloak x-transition:enter="transition ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95" class="absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-50">
                                <div class="py-1">
                                    <a href="{{ url_for('admin.court_blocking') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <span class="material-icons text-sm">block</span>
                                        <span>Platz-Sperrungen</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- My Account Dropdown -->
                        <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="hover:bg-green-600 px-3 py-2 rounded transition-colors flex items-center gap-1" aria-haspopup="true" :aria-expanded="open">
                                <span class="material-icons text-sm">account_circle</span>
                                <span>Mein Konto</span>
                                <span class="material-icons text-sm" :class="{ 'rotate-180': open }" style="transition: transform 0.2s">expand_more</span>
                            </button>
                            <div x-show="open" x-cloak x-transition:enter="transition ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95" class="absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg z-50">
                                <div class="py-1">
                                    <a href="{{ url_for('reservations.list_reservations') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <span class="material-icons text-sm">event</span>
                                        <span>Meine Reservierungen</span>
                                    </a>
                                    <a href="{{ url_for('members.favourites_page') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <span class="material-icons text-sm">star</span>
                                        <span>Favoriten</span>
                                    </a>
                                    <hr class="my-1">
                                    <a href="{{ url_for('auth.logout') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <span class="material-icons text-sm">logout</span>
                                        <span>Abmelden</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <a href="{{ url_for('auth.login') }}" class="hover:bg-green-600 px-3 py-2 rounded transition-colors flex items-center gap-1">
                            <span class="material-icons text-sm">login</span>
                            <span>Anmelden</span>
                        </a>
                    {% endif %}
                    </div>

                    <!-- Mobile Menu Button -->
                    <button class="lg:hidden text-white" @click="mobileMenuOpen = !mobileMenuOpen" aria-label="Menü öffnen">
                        <span class="material-icons">menu</span>
                    </button>
                </div>

            <!-- Mobile Menu (shown when hamburger is clicked) -->
            <div x-show="mobileMenuOpen" x-cloak @click.away="mobileMenuOpen = false" class="lg:hidden mt-4 pb-4">
                {% if current_user.is_authenticated %}
                    <!-- Dashboard -->
                    <a href="{{ url_for('dashboard.dashboard') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded">
                        <span class="material-icons text-sm">home</span>
                        <span>Dashboard</span>
                    </a>

                    <!-- Admin Panel Section (only for admins) -->
                    {% if current_user.is_admin() %}
                    <div x-data="{ adminOpen: false }" class="mt-2">
                        <button @click="adminOpen = !adminOpen" class="w-full flex items-center justify-between px-3 py-2 hover:bg-green-600 rounded">
                            <div class="flex items-center gap-2">
                                <span class="material-icons text-sm">admin_panel_settings</span>
                                <span>Admin</span>
                            </div>
                            <span class="material-icons text-sm" :class="{ 'rotate-180': adminOpen }" style="transition: transform 0.2s">expand_more</span>
                        </button>
                        <div x-show="adminOpen" x-cloak class="pl-6 mt-1 space-y-1">
                            <a href="{{ url_for('admin.overview') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded text-sm">
                                <span class="material-icons text-sm">dashboard</span>
                                <span>Übersicht</span>
                            </a>
                            <a href="{{ url_for('admin.court_blocking') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded text-sm">
                                <span class="material-icons text-sm">block</span>
                                <span>Platz-Sperrungen</span>
                            </a>
                            <a href="{{ url_for('admin.reasons') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded text-sm">
                                <span class="material-icons text-sm">list_alt</span>
                                <span>Sperrungsgründe</span>
                            </a>
                            <a href="{{ url_for('admin.calendar') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded text-sm">
                                <span class="material-icons text-sm">calendar_month</span>
                                <span>Kalenderansicht</span>
                            </a>
                            <a href="{{ url_for('members.list_members') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded text-sm">
                                <span class="material-icons text-sm">people</span>
                                <span>Mitglieder</span>
                            </a>
                            <a href="{{ url_for('admin.audit_log') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded text-sm">
                                <span class="material-icons text-sm">history</span>
                                <span>Audit-Protokoll</span>
                            </a>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Teamster Panel Section (teamsters only, NOT admins) -->
                    {% if current_user.is_teamster() and not current_user.is_admin() %}
                    <div x-data="{ teamsterOpen: false }" class="mt-2">
                        <button @click="teamsterOpen = !teamsterOpen" class="w-full flex items-center justify-between px-3 py-2 hover:bg-green-600 rounded">
                            <div class="flex items-center gap-2">
                                <span class="material-icons text-sm">block</span>
                                <span>Platz-Sperrungen</span>
                            </div>
                            <span class="material-icons text-sm" :class="{ 'rotate-180': teamsterOpen }" style="transition: transform 0.2s">expand_more</span>
                        </button>
                        <div x-show="teamsterOpen" x-cloak class="pl-6 mt-1 space-y-1">
                            <a href="{{ url_for('admin.court_blocking') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded text-sm">
                                <span class="material-icons text-sm">block</span>
                                <span>Platz-Sperrungen verwalten</span>
                            </a>
                        </div>
                    </div>
                    {% endif %}

                    <!-- My Account Section -->
                    <div x-data="{ accountOpen: false }">
                        <button @click="accountOpen = !accountOpen" class="w-full flex items-center justify-between px-3 py-2 hover:bg-green-600 rounded">
                            <div class="flex items-center gap-2">
                                <span class="material-icons text-sm">account_circle</span>
                                <span>Mein Konto</span>
                            </div>
                            <span class="material-icons text-sm" :class="{ 'rotate-180': accountOpen }" style="transition: transform 0.2s">expand_more</span>
                        </button>
                        <div x-show="accountOpen" x-cloak class="pl-6 mt-1 space-y-1">
                            <a href="{{ url_for('reservations.list_reservations') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded text-sm">
                                <span class="material-icons text-sm">event</span>
                                <span>Meine Reservierungen</span>
                            </a>
                            <a href="{{ url_for('members.favourites_page') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded text-sm">
                                <span class="material-icons text-sm">star</span>
                                <span>Favoriten</span>
                            </a>
                            <a href="{{ url_for('auth.logout') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded text-sm">
                                <span class="material-icons text-sm">logout</span>
                                <span>Abmelden</span>
                            </a>
                        </div>
                    </div>
                {% else %}
                    <a href="{{ url_for('dashboard.anonymous_overview') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded">
                        <span class="material-icons text-sm">visibility</span>
                        <span>Platzübersicht</span>
                    </a>
                    <a href="{{ url_for('auth.login') }}" class="flex items-center gap-2 px-3 py-2 hover:bg-green-600 rounded">
                        <span class="material-icons text-sm">login</span>
                        <span>Anmelden</span>
                    </a>
                {% endif %}
            </div>
        </div>
    </nav>

    <div class="container mx-auto mt-8 px-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="mb-4 p-4 rounded flex items-center gap-3 {% if category == 'error' %}bg-red-100 text-red-700{% elif category == 'success' %}bg-green-100 text-green-700{% else %}bg-blue-100 text-blue-700{% endif %}">
                    <span class="material-icons">
                        {% if category == 'error' %}error{% elif category == 'success' %}check_circle{% else %}info{% endif %}
                    </span>
                    <span>{{ message }}</span>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>
    
    <!-- Screen Reader Live Region for Announcements -->
    <div id="sr-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    
    <script>
    // Enhanced toast notification system
    class ToastManager {
        constructor() {
            this.container = document.getElementById('toast-container');
            this.toasts = new Map();
            this.toastId = 0;
        }
        
        show(message, type = 'success', options = {}) {
            const id = ++this.toastId;
            const toast = this.createToast(id, message, type, options);
            
            this.container.appendChild(toast);
            this.toasts.set(id, toast);
            
            // Animate in
            requestAnimationFrame(() => {
                toast.style.transform = 'translateX(0)';
                toast.style.opacity = '1';
            });
            
            // Auto-dismiss for success messages, keep error messages until dismissed
            if (type === 'success' || type === 'info' || type === 'warning') {
                const duration = options.duration || (type === 'success' ? 3000 : type === 'warning' ? 5000 : 4000);
                setTimeout(() => this.dismiss(id), duration);
            }
            
            return id;
        }
        
        createToast(id, message, type, options) {
            const toast = document.createElement('div');
            toast.className = `toast-item transform translate-x-full opacity-0 transition-all duration-300 ease-out`;
            toast.setAttribute('data-toast-id', id);
            
            const typeConfig = {
                success: { bg: 'bg-green-600', icon: 'check_circle' },
                error: { bg: 'bg-red-600', icon: 'error' },
                warning: { bg: 'bg-yellow-600', icon: 'warning' },
                info: { bg: 'bg-blue-600', icon: 'info' }
            };
            
            const config = typeConfig[type] || typeConfig.success;
            
            toast.innerHTML = `
                <div class="${config.bg} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 min-w-80 max-w-md">
                    <span class="material-icons text-sm flex-shrink-0">${config.icon}</span>
                    <span class="flex-1 text-sm font-medium">${this.escapeHtml(message)}</span>
                    ${type === 'error' ? `
                        <button onclick="toastManager.dismiss(${id})" class="flex-shrink-0 ml-2 text-white hover:text-gray-200 transition-colors">
                            <span class="material-icons text-sm">close</span>
                        </button>
                    ` : ''}
                </div>
            `;
            
            return toast;
        }
        
        dismiss(id) {
            const toast = this.toasts.get(id);
            if (!toast) return;
            
            // Animate out
            toast.style.transform = 'translateX(100%)';
            toast.style.opacity = '0';
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
                this.toasts.delete(id);
            }, 300);
        }
        
        dismissAll() {
            this.toasts.forEach((toast, id) => this.dismiss(id));
        }
        
        escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    }
    
    // Global toast manager instance
    const toastManager = new ToastManager();
    
    // Global convenience functions for backward compatibility
    function showToast(message, type = 'success', options = {}) {
        return toastManager.show(message, type, options);
    }
    
    function showSuccessToast(message, options = {}) {
        return toastManager.show(message, 'success', options);
    }
    
    function showErrorToast(message, options = {}) {
        return toastManager.show(message, 'error', options);
    }
    
    function showWarningToast(message, options = {}) {
        return toastManager.show(message, 'warning', options);
    }
    
    function showInfoToast(message, options = {}) {
        return toastManager.show(message, 'info', options);
    }
    </script>
    
    {% block extra_js %}{% endblock %}
    
    <!-- Alpine.js for reactive components -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
</body>
</html>
