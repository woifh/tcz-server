<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Tennisclub Reservierung{% endblock %}</title>
    <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        .material-icons { vertical-align: middle; }
        /* Hide elements until Alpine.js loads */
        [x-cloak] { display: none !important; }
        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        /* Show skip links when focused */
        .focus\:not-sr-only:focus {
            position: static;
            width: auto;
            height: auto;
            padding: 0.5rem 1rem;
            margin: 0;
            overflow: visible;
            clip: auto;
            white-space: normal;
        }
    </style>
</head>
<body class="bg-gray-100">
    <nav class="bg-green-700 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold flex items-center gap-2">
                <span class="material-icons">sports_tennis</span>
                Tennisclub Zellerndorf
            </h1>
            <div class="flex gap-4 items-center">
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('dashboard.dashboard') }}" class="hover:underline flex items-center gap-1">
                        <span class="material-icons text-sm">dashboard</span>
                        Übersicht
                    </a>
                    <a href="{{ url_for('reservations.list_reservations') }}" class="hover:underline flex items-center gap-1">
                        <span class="material-icons text-sm">event</span>
                        Meine Buchungen
                    </a>
                    <a href="{{ url_for('members.favourites_page') }}" class="hover:underline flex items-center gap-1">
                        <span class="material-icons text-sm">favorite</span>
                        Favoriten
                    </a>
                    {% if current_user.is_admin() %}
                    <a href="{{ url_for('admin.index') }}" class="hover:underline flex items-center gap-1">
                        <span class="material-icons text-sm">admin_panel_settings</span>
                        Admin-Panel
                    </a>
                    <a href="{{ url_for('members.list_members') }}" class="hover:underline flex items-center gap-1">
                        <span class="material-icons text-sm">people</span>
                        Mitglieder
                    </a>
                    {% endif %}
                    <span class="flex items-center gap-1">
                        <span class="material-icons text-sm">account_circle</span>
                        {{ current_user.name }}
                    </span>
                    <a href="{{ url_for('auth.logout') }}" class="hover:underline flex items-center gap-1">
                        <span class="material-icons text-sm">logout</span>
                        Abmelden
                    </a>
                {% else %}
                    <a href="{{ url_for('dashboard.anonymous_overview') }}" class="hover:underline flex items-center gap-1">
                        <span class="material-icons text-sm">visibility</span>
                        Platzübersicht
                    </a>
                    <a href="{{ url_for('auth.login') }}" class="hover:underline flex items-center gap-1">
                        <span class="material-icons text-sm">login</span>
                        Anmelden
                    </a>
                {% endif %}
            </div>
        </div>
    </nav>

    <div class="container mx-auto mt-8 px-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="mb-4 p-4 rounded flex items-center gap-3 {% if category == 'error' %}bg-red-100 text-red-700{% elif category == 'success' %}bg-green-100 text-green-700{% else %}bg-blue-100 text-blue-700{% endif %}">
                    <span class="material-icons">
                        {% if category == 'error' %}error{% elif category == 'success' %}check_circle{% else %}info{% endif %}
                    </span>
                    <span>{{ message }}</span>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>
    
    <!-- Screen Reader Live Region for Announcements -->
    <div id="sr-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    
    <script>
    // Enhanced toast notification system
    class ToastManager {
        constructor() {
            this.container = document.getElementById('toast-container');
            this.toasts = new Map();
            this.toastId = 0;
        }
        
        show(message, type = 'success', options = {}) {
            const id = ++this.toastId;
            const toast = this.createToast(id, message, type, options);
            
            this.container.appendChild(toast);
            this.toasts.set(id, toast);
            
            // Animate in
            requestAnimationFrame(() => {
                toast.style.transform = 'translateX(0)';
                toast.style.opacity = '1';
            });
            
            // Auto-dismiss for success messages, keep error messages until dismissed
            if (type === 'success' || type === 'info' || type === 'warning') {
                const duration = options.duration || (type === 'success' ? 3000 : type === 'warning' ? 5000 : 4000);
                setTimeout(() => this.dismiss(id), duration);
            }
            
            return id;
        }
        
        createToast(id, message, type, options) {
            const toast = document.createElement('div');
            toast.className = `toast-item transform translate-x-full opacity-0 transition-all duration-300 ease-out`;
            toast.setAttribute('data-toast-id', id);
            
            const typeConfig = {
                success: { bg: 'bg-green-600', icon: 'check_circle' },
                error: { bg: 'bg-red-600', icon: 'error' },
                warning: { bg: 'bg-yellow-600', icon: 'warning' },
                info: { bg: 'bg-blue-600', icon: 'info' }
            };
            
            const config = typeConfig[type] || typeConfig.success;
            
            toast.innerHTML = `
                <div class="${config.bg} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 min-w-80 max-w-md">
                    <span class="material-icons text-sm flex-shrink-0">${config.icon}</span>
                    <span class="flex-1 text-sm font-medium">${this.escapeHtml(message)}</span>
                    ${type === 'error' ? `
                        <button onclick="toastManager.dismiss(${id})" class="flex-shrink-0 ml-2 text-white hover:text-gray-200 transition-colors">
                            <span class="material-icons text-sm">close</span>
                        </button>
                    ` : ''}
                </div>
            `;
            
            return toast;
        }
        
        dismiss(id) {
            const toast = this.toasts.get(id);
            if (!toast) return;
            
            // Animate out
            toast.style.transform = 'translateX(100%)';
            toast.style.opacity = '0';
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
                this.toasts.delete(id);
            }, 300);
        }
        
        dismissAll() {
            this.toasts.forEach((toast, id) => this.dismiss(id));
        }
        
        escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    }
    
    // Global toast manager instance
    const toastManager = new ToastManager();
    
    // Global convenience functions for backward compatibility
    function showToast(message, type = 'success', options = {}) {
        return toastManager.show(message, type, options);
    }
    
    function showSuccessToast(message, options = {}) {
        return toastManager.show(message, 'success', options);
    }
    
    function showErrorToast(message, options = {}) {
        return toastManager.show(message, 'error', options);
    }
    
    function showWarningToast(message, options = {}) {
        return toastManager.show(message, 'warning', options);
    }
    
    function showInfoToast(message, options = {}) {
        return toastManager.show(message, 'info', options);
    }
    </script>
    
    {% block extra_js %}{% endblock %}
    
    <!-- Alpine.js for reactive components -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
</body>
</html>
