{% extends "base.html" %}

{% block title %}Audit-Protokoll - Admin - Tennisclub{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-md p-6">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold">Audit-Protokoll</h2>
    </div>

    <p class="text-gray-600 mb-6">Verlauf aller administrativen Operationen (Buchungen, Sperrungen, Mitglieder, Sperrungsgründe).</p>

    <!-- Type Filter Buttons -->
    <div class="flex flex-wrap gap-2 mb-4">
        <span class="text-sm text-gray-500 font-medium self-center mr-2">Typ:</span>
        <button id="filter-all" class="px-4 py-2 rounded-lg text-sm font-medium bg-green-600 text-white">
            Alle
        </button>
        <button id="filter-reservation" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
            Buchungen
        </button>
        <button id="filter-block" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
            Sperrungen
        </button>
        <button id="filter-member" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
            Mitglieder
        </button>
        <button id="filter-reason" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
            Sperrungsgründe
        </button>
    </div>

    <!-- Actor Filter Buttons -->
    <div class="flex flex-wrap gap-2 mb-6">
        <span class="text-sm text-gray-500 font-medium self-center mr-2">Akteur:</span>
        <button id="actor-all" class="px-4 py-2 rounded-lg text-sm font-medium bg-green-600 text-white">
            Alle Akteure
        </button>
        <button id="actor-admin" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
            Admin-Aktionen
        </button>
        <button id="actor-member" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
            Mitglieder-Aktionen
        </button>
        <button id="actor-system" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
            System-Aktionen
        </button>
    </div>

    <!-- Search Filter -->
    <div class="mb-6">
        <div class="flex flex-col sm:flex-row gap-4">
            <div class="flex-1">
                <label for="search-input" class="sr-only">Suche</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                    <input type="text" id="search-input" placeholder="Suche nach Benutzer, Details..."
                           class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                </div>
            </div>
            <div class="flex gap-2">
                <input type="date" id="date-from"
                       class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                       title="Von Datum">
                <input type="date" id="date-to"
                       class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                       title="Bis Datum">
                <button id="clear-filters" class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg" title="Filter zurücksetzen">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Audit Log Container -->
    <div id="audit-log-container" class="bg-white border border-gray-200 rounded-lg">
        <div class="p-8 text-center text-gray-500">
            <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-green-600 mr-2"></div>
            <p>Audit-Protokoll wird geladen...</p>
        </div>
    </div>
</div>

<script type="module">
    let currentTypeFilter = null;
    let currentActorFilter = null;
    let allLogs = [];
    let searchQuery = '';
    let dateFrom = null;
    let dateTo = null;

    // Type filter button handlers
    document.getElementById('filter-all').addEventListener('click', () => setTypeFilter(null));
    document.getElementById('filter-reservation').addEventListener('click', () => setTypeFilter('reservation'));
    document.getElementById('filter-block').addEventListener('click', () => setTypeFilter('block'));
    document.getElementById('filter-member').addEventListener('click', () => setTypeFilter('member'));
    document.getElementById('filter-reason').addEventListener('click', () => setTypeFilter('reason'));

    // Actor filter button handlers
    document.getElementById('actor-all').addEventListener('click', () => setActorFilter(null));
    document.getElementById('actor-admin').addEventListener('click', () => setActorFilter('admin'));
    document.getElementById('actor-member').addEventListener('click', () => setActorFilter('member'));
    document.getElementById('actor-system').addEventListener('click', () => setActorFilter('system'));

    // Search input handler with debounce
    let searchTimeout = null;
    document.getElementById('search-input').addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            searchQuery = e.target.value.toLowerCase().trim();
            renderLogs();
        }, 300);
    });

    // Date filter handlers
    document.getElementById('date-from').addEventListener('change', (e) => {
        dateFrom = e.target.value ? new Date(e.target.value) : null;
        renderLogs();
    });

    document.getElementById('date-to').addEventListener('change', (e) => {
        dateTo = e.target.value ? new Date(e.target.value + 'T23:59:59') : null;
        renderLogs();
    });

    // Clear filters handler
    document.getElementById('clear-filters').addEventListener('click', () => {
        searchQuery = '';
        dateFrom = null;
        dateTo = null;
        currentTypeFilter = null;
        currentActorFilter = null;
        document.getElementById('search-input').value = '';
        document.getElementById('date-from').value = '';
        document.getElementById('date-to').value = '';
        updateFilterButtons();
        renderLogs();
    });

    function setTypeFilter(type) {
        currentTypeFilter = type;
        updateFilterButtons();
        renderLogs();
    }

    function setActorFilter(actor) {
        currentActorFilter = actor;
        updateFilterButtons();
        renderLogs();
    }

    function updateFilterButtons() {
        // Type filter buttons
        const typeButtons = {
            'filter-all': null,
            'filter-reservation': 'reservation',
            'filter-block': 'block',
            'filter-member': 'member',
            'filter-reason': 'reason'
        };

        Object.entries(typeButtons).forEach(([id, filterType]) => {
            const btn = document.getElementById(id);
            if (filterType === currentTypeFilter) {
                btn.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-green-600 text-white';
            } else {
                btn.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200';
            }
        });

        // Actor filter buttons
        const actorButtons = {
            'actor-all': null,
            'actor-admin': 'admin',
            'actor-member': 'member',
            'actor-system': 'system'
        };

        Object.entries(actorButtons).forEach(([id, filterActor]) => {
            const btn = document.getElementById(id);
            if (filterActor === currentActorFilter) {
                btn.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-green-600 text-white';
            } else {
                btn.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200';
            }
        });
    }

    function getActionBadge(action) {
        const actionMap = {
            'create': { label: 'Erstellt', class: 'bg-green-100 text-green-800' },
            'update': { label: 'Aktualisiert', class: 'bg-blue-100 text-blue-800' },
            'delete': { label: 'Gelöscht', class: 'bg-red-100 text-red-800' },
            'cancel': { label: 'Storniert', class: 'bg-red-100 text-red-800' },
            'role_change': { label: 'Rolle', class: 'bg-purple-100 text-purple-800' },
            'membership_change': { label: 'Mitgliedschaft', class: 'bg-indigo-100 text-indigo-800' },
            'payment_update': { label: 'Beitrag', class: 'bg-yellow-100 text-yellow-800' },
            'payment_confirmation': { label: 'Zahlung bestätigt', class: 'bg-green-100 text-green-800' },
            'payment_confirmation_request': { label: 'Zahlungsbestätigung angefordert', class: 'bg-blue-100 text-blue-800' },
            'payment_confirmation_reject': { label: 'Zahlung abgelehnt', class: 'bg-red-100 text-red-800' },
            'deactivate': { label: 'Deaktiviert', class: 'bg-orange-100 text-orange-800' },
            'reactivate': { label: 'Reaktiviert', class: 'bg-teal-100 text-teal-800' },
            'permanent_delete': { label: 'Endgültig gelöscht', class: 'bg-red-100 text-red-800' },
            'add_favourite': { label: 'Favorit +', class: 'bg-pink-100 text-pink-800' },
            'remove_favourite': { label: 'Favorit -', class: 'bg-pink-100 text-pink-800' },
            'csv_import': { label: 'CSV-Import', class: 'bg-cyan-100 text-cyan-800' },
            'annual_fee_reset': { label: 'Beitrags-Reset', class: 'bg-amber-100 text-amber-800' }
        };
        return actionMap[action] || { label: action, class: 'bg-gray-100 text-gray-800' };
    }

    function getTypeBadge(type) {
        if (type === 'reservation') {
            return '<span class="px-2 py-0.5 text-xs rounded bg-blue-100 text-blue-600">Buchung</span>';
        } else if (type === 'block') {
            return '<span class="px-2 py-0.5 text-xs rounded bg-gray-100 text-gray-600">Sperrung</span>';
        } else if (type === 'member') {
            return '<span class="px-2 py-0.5 text-xs rounded bg-gray-100 text-gray-600">Mitglied</span>';
        } else if (type === 'reason') {
            return '<span class="px-2 py-0.5 text-xs rounded bg-gray-100 text-gray-600">Sperrungsgrund</span>';
        }
        return '';
    }

    // Field name translations for human-readable display
    const fieldLabels = {
        'firstname': 'Vorname',
        'lastname': 'Nachname',
        'email': 'E-Mail',
        'role': 'Rolle',
        'membership_type': 'Mitgliedschaft',
        'fee_paid': 'Beitrag bezahlt',
        'street': 'Straße',
        'city': 'Stadt',
        'zip_code': 'PLZ',
        'phone': 'Telefon',
        'notifications_enabled': 'Benachrichtigungen',
        'notify_own_bookings': 'Eigene Buchungen',
        'notify_other_bookings': 'Andere Buchungen',
        'notify_court_blocked': 'Platzsperrungen',
        'notify_booking_overridden': 'Überschriebene Buchungen',
        'name': 'Name',
        'member_name': 'Mitglied',
        'teamster_usable': 'Für Mannschaftsführer',
        'performer_role': 'Ausführende Rolle',
        'date': 'Datum',
        'start_time': 'Startzeit',
        'end_time': 'Endzeit',
        'court_id': 'Platz',
        'court_ids': 'Plätze',
        'court_numbers': 'Plätze',
        'reason_id': 'Sperrungsgrund-ID',
        'reason_name': 'Sperrungsgrund',
        'details': 'Details',
        'is_active': 'Aktiv',
        'old': 'Vorher',
        'new': 'Nachher',
        'changes': 'Änderungen'
    };

    // Role translations
    const roleLabels = {
        'member': 'Mitglied',
        'teamster': 'Mannschaftsführer',
        'administrator': 'Administrator',
        'admin': 'Administrator'
    };

    // Membership type translations
    const membershipLabels = {
        'full': 'Vollmitglied',
        'sustaining': 'Fördermitglied',
        'junior': 'Jugendmitglied'
    };

    function formatValue(key, value) {
        if (value === null || value === undefined || value === '') return '-';
        if (typeof value === 'boolean') return value ? 'Ja' : 'Nein';
        if (value === 'True' || value === 'true') return 'Ja';
        if (value === 'False' || value === 'false') return 'Nein';

        // Translate roles
        if (key === 'role' || key === 'performer_role') {
            return roleLabels[value] || value;
        }

        // Translate membership types
        if (key === 'membership_type') {
            return membershipLabels[value] || value;
        }

        return value;
    }

    function formatDetails(detailsStr, logType, action) {
        if (!detailsStr || detailsStr === '-') return '-';

        try {
            // Try to parse as Python dict format (single quotes)
            let details;
            try {
                // Convert Python dict format to JSON
                const jsonStr = detailsStr
                    .replace(/'/g, '"')
                    .replace(/True/g, 'true')
                    .replace(/False/g, 'false')
                    .replace(/None/g, 'null');
                details = JSON.parse(jsonStr);
            } catch {
                // If parsing fails, return as-is
                return escapeHtml(detailsStr);
            }

            const lines = [];

            // Handle 'changes' object for updates
            if (details.changes) {
                lines.push('<div class="space-y-1">');
                // Show member name if present (for member updates)
                if (details.member_name) {
                    lines.push(`<div class="font-medium text-gray-900 mb-1">${escapeHtml(details.member_name)}</div>`);
                }
                for (const [field, change] of Object.entries(details.changes)) {
                    const label = fieldLabels[field] || field;
                    const oldVal = formatValue(field, change.old);
                    const newVal = formatValue(field, change.new);
                    lines.push(`<div class="flex items-center gap-2">`);
                    lines.push(`<span class="font-medium text-gray-700">${escapeHtml(label)}:</span>`);
                    lines.push(`<span class="text-red-600 line-through">${escapeHtml(oldVal)}</span>`);
                    lines.push(`<span class="text-gray-400">→</span>`);
                    lines.push(`<span class="text-green-600">${escapeHtml(newVal)}</span>`);
                    lines.push(`</div>`);
                }
                lines.push('</div>');
                return lines.join('');
            }

            // Handle block updates - show current state
            if (logType === 'block' && action === 'update') {
                lines.push('<div class="space-y-0.5">');
                if (details.date) {
                    lines.push(`<div><span class="font-medium text-gray-700">Datum:</span> ${escapeHtml(details.date)}</div>`);
                }
                if (details.start_time && details.end_time) {
                    lines.push(`<div><span class="font-medium text-gray-700">Zeit:</span> ${escapeHtml(details.start_time)} - ${escapeHtml(details.end_time)}</div>`);
                }
                if (details.court_numbers && details.court_numbers.length > 0) {
                    const courtLabel = details.court_numbers.length === 1 ? 'Platz' : 'Plätze';
                    lines.push(`<div><span class="font-medium text-gray-700">${courtLabel}:</span> ${escapeHtml(details.court_numbers.join(', '))}</div>`);
                }
                if (details.reason_name) {
                    lines.push(`<div><span class="font-medium text-gray-700">Sperrungsgrund:</span> ${escapeHtml(details.reason_name)}</div>`);
                }
                if (details.details) {
                    lines.push(`<div><span class="font-medium text-gray-700">Details:</span> ${escapeHtml(details.details)}</div>`);
                }
                lines.push('</div>');
                return lines.join('');
            }

            // Handle create/delete actions - show key fields
            if (action === 'create' || action === 'delete' || action === 'deactivate' || action === 'reactivate' || action === 'permanent_delete') {
                lines.push('<div class="space-y-0.5">');

                // For members: show name and email
                if (logType === 'member') {
                    if (details.firstname || details.lastname) {
                        const name = `${details.firstname || ''} ${details.lastname || ''}`.trim();
                        lines.push(`<div><span class="font-medium text-gray-700">Name:</span> ${escapeHtml(name)}</div>`);
                    }
                    if (details.email) {
                        lines.push(`<div><span class="font-medium text-gray-700">E-Mail:</span> ${escapeHtml(details.email)}</div>`);
                    }
                    if (details.role) {
                        lines.push(`<div><span class="font-medium text-gray-700">Rolle:</span> ${escapeHtml(roleLabels[details.role] || details.role)}</div>`);
                    }
                    if (details.membership_type) {
                        lines.push(`<div><span class="font-medium text-gray-700">Mitgliedschaft:</span> ${escapeHtml(membershipLabels[details.membership_type] || details.membership_type)}</div>`);
                    }
                }

                // For block reasons: show name
                if (logType === 'reason') {
                    if (details.name) {
                        lines.push(`<div><span class="font-medium text-gray-700">Sperrungsgrund:</span> ${escapeHtml(details.name)}</div>`);
                    }
                    if (details.teamster_usable !== undefined) {
                        lines.push(`<div><span class="font-medium text-gray-700">Für Mannschaftsführer:</span> ${details.teamster_usable ? 'Ja' : 'Nein'}</div>`);
                    }
                    if (details.future_blocks_deleted !== undefined && details.future_blocks_deleted > 0) {
                        lines.push(`<div><span class="font-medium text-gray-700">Zukünftige Sperrungen gelöscht:</span> ${details.future_blocks_deleted}</div>`);
                    }
                    if (details.blocks_deleted !== undefined && details.blocks_deleted > 0) {
                        lines.push(`<div><span class="font-medium text-gray-700">Sperrungen gelöscht:</span> ${details.blocks_deleted}</div>`);
                    }
                }

                // For blocks: show date, time, courts, and reason
                if (logType === 'block') {
                    if (details.date) {
                        lines.push(`<div><span class="font-medium text-gray-700">Datum:</span> ${escapeHtml(details.date)}</div>`);
                    }
                    if (details.start_time && details.end_time) {
                        lines.push(`<div><span class="font-medium text-gray-700">Zeit:</span> ${escapeHtml(details.start_time)} - ${escapeHtml(details.end_time)}</div>`);
                    }
                    if (details.court_numbers && details.court_numbers.length > 0) {
                        const courtLabel = details.court_numbers.length === 1 ? 'Platz' : 'Plätze';
                        lines.push(`<div><span class="font-medium text-gray-700">${courtLabel}:</span> ${escapeHtml(details.court_numbers.join(', '))}</div>`);
                    } else if (details.court_id) {
                        lines.push(`<div><span class="font-medium text-gray-700">Platz:</span> ${escapeHtml(details.court_id)}</div>`);
                    }
                    if (details.reason_name) {
                        lines.push(`<div><span class="font-medium text-gray-700">Sperrungsgrund:</span> ${escapeHtml(details.reason_name)}</div>`);
                    }
                }

                lines.push('</div>');
                return lines.join('');
            }

            // Fallback: format all fields nicely
            lines.push('<div class="space-y-0.5">');
            for (const [key, value] of Object.entries(details)) {
                if (key === 'performer_role') continue; // Skip, shown separately
                const label = fieldLabels[key] || key;
                const formattedValue = formatValue(key, value);
                lines.push(`<div><span class="font-medium text-gray-700">${escapeHtml(label)}:</span> ${escapeHtml(formattedValue)}</div>`);
            }
            lines.push('</div>');
            return lines.join('');

        } catch (e) {
            console.error('Error formatting details:', e);
            return escapeHtml(detailsStr);
        }
    }

    function escapeHtml(text) {
        if (text === null || text === undefined) return '';
        const div = document.createElement('div');
        div.textContent = String(text);
        return div.innerHTML;
    }

    function renderLogs() {
        const container = document.getElementById('audit-log-container');
        let filteredLogs = allLogs;

        // Apply type filter
        if (currentTypeFilter) {
            filteredLogs = filteredLogs.filter(log => log.type === currentTypeFilter);
        }

        // Apply actor filter
        if (currentActorFilter) {
            filteredLogs = filteredLogs.filter(log => {
                const role = log.performer_role || 'system';
                if (currentActorFilter === 'admin') {
                    // For reservations, use is_admin_action flag
                    if (log.type === 'reservation') {
                        return log.is_admin_action === true;
                    }
                    // For other types (block, member, reason), check performer role
                    return role === 'administrator' || role === 'teamster';
                } else if (currentActorFilter === 'member') {
                    // For reservations, use is_admin_action flag (false = member action)
                    if (log.type === 'reservation') {
                        return log.is_admin_action === false;
                    }
                    // Other types with member role
                    return role === 'member';
                } else if (currentActorFilter === 'system') {
                    return role === 'system';
                }
                return true;
            });
        }

        // Apply text search filter
        if (searchQuery) {
            filteredLogs = filteredLogs.filter(log => {
                const user = (log.user || '').toLowerCase();
                const details = (log.details || '').toLowerCase();
                const action = (log.action || '').toLowerCase();
                const type = (log.type || '').toLowerCase();
                return user.includes(searchQuery) ||
                       details.includes(searchQuery) ||
                       action.includes(searchQuery) ||
                       type.includes(searchQuery);
            });
        }

        // Apply date range filter
        if (dateFrom || dateTo) {
            filteredLogs = filteredLogs.filter(log => {
                const logDate = new Date(log.timestamp + 'Z');
                if (dateFrom && logDate < dateFrom) return false;
                if (dateTo && logDate > dateTo) return false;
                return true;
            });
        }

        if (filteredLogs.length > 0) {
            container.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Zeitstempel</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Typ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aktion</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Benutzer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Details</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${filteredLogs.map(log => {
                                const actionBadge = getActionBadge(log.action);
                                return `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            ${new Date(log.timestamp + 'Z').toLocaleString('de-DE')}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            ${getTypeBadge(log.type)}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${actionBadge.class}">
                                                ${actionBadge.label}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            ${log.user || 'System'}
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-500 max-w-md">
                                            ${formatDetails(log.details, log.type, log.action)}
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        } else {
            const hasFilters = currentTypeFilter || currentActorFilter || searchQuery || dateFrom || dateTo;
            container.innerHTML = `
                <div class="p-8 text-center text-gray-500">
                    <p class="text-lg font-medium">${hasFilters ? 'Keine passenden Einträge' : 'Keine Einträge gefunden'}</p>
                    <p class="text-sm mt-1">${hasFilters ? 'Versuchen Sie andere Filterkriterien.' : 'Es wurden noch keine administrativen Operationen durchgeführt.'}</p>
                </div>
            `;
        }
    }

    // Load audit log on page load
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            const response = await fetch('/api/admin/blocks/audit-log');
            const data = await response.json();

            if (data.success && data.logs) {
                allLogs = data.logs;
                renderLogs();
            } else {
                allLogs = [];
                renderLogs();
            }
        } catch (error) {
            console.error('Error loading audit log:', error);
            const container = document.getElementById('audit-log-container');
            container.innerHTML = `
                <div class="p-8 text-center text-red-500">
                    <svg class="mx-auto h-12 w-12 text-red-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <p class="text-lg font-medium">Fehler beim Laden</p>
                    <p class="text-sm mt-1">Das Audit-Protokoll konnte nicht geladen werden.</p>
                </div>
            `;
        }
    });
</script>
{% endblock %}
